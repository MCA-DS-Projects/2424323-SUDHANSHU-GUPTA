<!DOCTYPE html>
<html>
<head>
    <title>End Session Button Verification</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>End Session Button Verification Report</h1>
    <div id="results"></div>
    
    <script>
        async function verifyButtons() {
            const results = document.getElementById('results');
            let html = '';
            
            // Check Audio Practice Mode
            html += '<h2>Audio Practice Mode</h2>';
            try {
                const audioResponse = await fetch('/pages/user/audio_practice_mode.html');
                const audioHtml = await audioResponse.text();
                
                // Check for button
                if (audioHtml.includes('id="endSessionBtn"')) {
                    html += '<p class="success">✅ End Session button found in HTML</p>';
                } else {
                    html += '<p class="error">❌ End Session button NOT found in HTML</p>';
                }
                
                // Check for event listener
                if (audioHtml.includes('endSessionBtn.addEventListener')) {
                    html += '<p class="success">✅ Event listener setup found</p>';
                } else {
                    html += '<p class="error">❌ Event listener setup NOT found</p>';
                }
                
                // Check for endPracticeSession function
                if (audioHtml.includes('function endPracticeSession')) {
                    html += '<p class="success">✅ endPracticeSession() function found</p>';
                } else {
                    html += '<p class="error">❌ endPracticeSession() function NOT found</p>';
                }
                
                // Check for redirect
                if (audioHtml.includes("window.location.href = '/pages/user/user_dashboard.html'")) {
                    html += '<p class="success">✅ Dashboard redirect found</p>';
                } else {
                    html += '<p class="error">❌ Dashboard redirect NOT found</p>';
                }
                
            } catch (error) {
                html += `<p class="error">❌ Error loading audio practice file: ${error.message}</p>`;
            }
            
            // Check Fluency Coach
            html += '<h2>Fluency Coach</h2>';
            try {
                const fluencyResponse = await fetch('/pages/user/fluency_coach.html');
                const fluencyHtml = await fluencyResponse.text();
                
                // Check for button
                if (fluencyHtml.includes('id="endSessionBtn"')) {
                    html += '<p class="success">✅ End Session button found in HTML</p>';
                } else {
                    html += '<p class="error">❌ End Session button NOT found in HTML</p>';
                }
                
                // Check for event listener
                if (fluencyHtml.includes('endSessionBtn.addEventListener')) {
                    html += '<p class="success">✅ Event listener setup found</p>';
                } else {
                    html += '<p class="error">❌ Event listener setup NOT found</p>';
                }
                
                // Check for endSession function
                if (fluencyHtml.includes('function endSession')) {
                    html += '<p class="success">✅ endSession() function found</p>';
                } else {
                    html += '<p class="error">❌ endSession() function NOT found</p>';
                }
                
                // Check for redirect
                if (fluencyHtml.includes("window.location.href = '/pages/user/user_dashboard.html'")) {
                    html += '<p class="success">✅ Dashboard redirect found</p>';
                } else {
                    html += '<p class="error">❌ Dashboard redirect NOT found</p>';
                }
                
            } catch (error) {
                html += `<p class="error">❌ Error loading fluency coach file: ${error.message}</p>`;
            }
            
            html += '<h2>Summary</h2>';
            html += '<p class="info">Both End Session buttons should now be working correctly!</p>';
            html += '<p class="info">Click the buttons on the actual pages to test them.</p>';
            
            results.innerHTML = html;
        }
        
        verifyButtons();
    </script>
</body>
</html>
